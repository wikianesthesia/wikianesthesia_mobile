mw.loader.implement("ext.gadget.calculator-core@t3iye",function($,jQuery,require,module){(function(){var COOKIE_EXPIRATION=12*60*60;var TYPE_NUMBER='number';var TYPE_STRING='string';var VALID_TYPES=[TYPE_NUMBER,TYPE_STRING];var DEFAULT_CALCULATION_CLASS='SimpleCalculation';math.roman=function(number){var romanOrders={M:1000,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};var roman='';for(var iOrder in romanOrders){var numOfOrder=Math.floor(number/romanOrders[iOrder]);number-=numOfOrder*romanOrders[iOrder];roman+=iOrder.repeat(numOfOrder);}return roman;};math.Unit.prototype.getBase=function(){for(var iBase in math.Unit.BASE_UNITS){if(this.equalBase(math.Unit.BASE_UNITS[iBase])){return iBase;}}return null;};mw.calculators={calculations:{},objectClasses:{},options:{},selectors:{calculationCategories:'.calculator-calculationcategory',calculations:'.calculator-calculation',calculatorOptions:'.calculator-options'},units:{},unitsBases:{},variables:{},addCalculations:
function(calculationData,className){className=className?className:DEFAULT_CALCULATION_CLASS;var calculations=mw.calculators.createCalculatorObjects(className,calculationData);for(var calculationId in calculations){var calculation=calculations[calculationId];mw.calculators.calculations[calculationId]=calculation;mw.calculators.calculations[calculationId].setDependencies();mw.calculators.calculations[calculationId].update();}},addUnitsBases:function(unitsBaseData){var unitsBases=mw.calculators.createCalculatorObjects('UnitsBase',unitsBaseData);for(var unitsBaseId in unitsBases){mw.calculators.unitsBases[unitsBaseId.toLowerCase()]=unitsBases[unitsBaseId];}},addUnits:function(unitsData){var units=mw.calculators.createCalculatorObjects('Units',unitsData);for(var unitsId in units){if(mw.calculators.units.hasOwnProperty(unitsId)){continue;}var unitData={aliases:units[unitsId].aliases,baseName:units[unitsId].baseName?units[unitsId].baseName.toUpperCase():units[unitsId].baseName,definition:
units[unitsId].definition,prefixes:units[unitsId].prefixes,offset:units[unitsId].offset};try{math.createUnit(unitsId,unitData);}catch(e){console.warn(e.message);}mw.calculators.units[unitsId]=units[unitsId];}},addVariables:function(variableData){var variables=mw.calculators.createCalculatorObjects('Variable',variableData);for(var variableId in variables){mw.calculators.variables[variableId]=variables[variableId];var cookieValue=mw.calculators.getCookieValue(variableId);if(cookieValue){if(!mw.calculators.variables[variableId].setValue(cookieValue)){mw.calculators.setCookieValue(variableId,null);}}}},createCalculatorObjects:function(className,objectData){if(!mw.calculators.objectClasses.hasOwnProperty(className)){throw new Error('Invalid class name "'+className+'"');}var objects={};for(var objectId in objectData){var propertyValues=objectData[objectId];if(propertyValues.hasOwnProperty('id')){objectId=propertyValues.id;}else{propertyValues.id=objectId;}objects[objectId]=new mw.calculators
.objectClasses[className](propertyValues);}return objects;},createInputGroup:function(variableIds,global,maxInputsPerRow){var $form=$('<form>',{novalidate:!0});var $formRow;var inputOptions={global:!!global};maxInputsPerRow=maxInputsPerRow?maxInputsPerRow:mw.calculators.getOptionValue('inputgroupmaxinputsperrow');var inputCount=0;for(var iVariableId in variableIds){var variableId=variableIds[iVariableId];if(!mw.calculators.variables.hasOwnProperty(variableId)){throw new Error('Invalid variable name "'+variableId+'"');}if(inputCount%maxInputsPerRow===0){if($formRow){$form.append($formRow);}$formRow=$('<div>',{class:'form-row calculator-inputGroup'});}$formRow.append(mw.calculators.variables[variableId].createInput(inputOptions));inputCount++;}return $form.append($formRow);},getCookieKey:function(variableId){return'calculators-var-'+variableId;},getCookieValue:function(varId){var cookieValue=mw.cookie.get(mw.calculators.getCookieKey(varId));if(!cookieValue){return null;}return cookieValue
;},getCalculation:function(calculationId){if(mw.calculators.calculations.hasOwnProperty(calculationId)){return mw.calculators.calculations[calculationId];}else{return null;}},getOptionValue:function(optionId){return mw.calculators.options.hasOwnProperty(optionId)?mw.calculators.options[optionId]:undefined;},getUnitsByBase:function(value){if(typeof value!=='object'||!value.hasOwnProperty('units')){return null;}var unitsByBase={};for(var iUnits in value.units){var units=value.units[iUnits];var baseId=units.unit.base.key.toLowerCase().replace(/_\w+/,'');unitsByBase[baseId]=units.prefix.name+units.unit.name;}return unitsByBase;},getUnitsString:function(value){if(typeof value!=='object'){return null;}var unitsString=value.formatUnits();var reDenominator=/\/\s?\((.*)\)/;var denominatorMatches=unitsString.match(reDenominator);if(denominatorMatches){var denominatorUnits=denominatorMatches[1];unitsString=unitsString.replace(reDenominator,'/'+denominatorUnits.replace(' ','/'));}unitsString=
unitsString.replace(/\s/g,'').replace(/(\^(\d+))/g,'<sup>$2</sup>');var unitsBase=value.getBase();if(unitsBase){unitsBase=unitsBase.toLowerCase();if(mw.calculators.unitsBases.hasOwnProperty(unitsBase)&&typeof mw.calculators.unitsBases[unitsBase].toString==='function'){unitsString=mw.calculators.unitsBases[unitsBase].toString(unitsString);}}else{unitsString=unitsString.replace('kgwt','kg');unitsString=unitsString.replace('ug','mcg');}return unitsString;},getValueDecimals:function(value){if(mw.calculators.isValueMathObject(value)){value=mw.calculators.getValueNumber(value);}if(typeof value!=='number'){return null;}var decimals=value.toString().split('').reverse().join('').indexOf('.');decimals=decimals>0?decimals:0;return decimals;},getValueNumber:function(value,decimals){if(!mw.calculators.isValueMathObject(value)){return null;}var number=math.round(value.toNumber(),10);var absNumber=math.abs(number);if(absNumber>=10||absNumber===0){if(absNumber<100&&absNumber!==math.round(absNumber)&&2
*absNumber===math.round(2*absNumber)){decimals=1;}else{decimals=0;}}else{decimals=-math.floor(math.log10(absNumber))+1;}return math.round(number,decimals);},getValueString:function(value,decimals){if(!mw.calculators.isValueMathObject(value)){return null;}var valueNumber=mw.calculators.getValueNumber(value,decimals);var valueUnits=mw.calculators.getUnitsString(value);if(math.abs(math.log10(valueNumber))>3){var valueUnitsByBase=mw.calculators.getUnitsByBase(value);var oldSIUnit;if(valueUnitsByBase.hasOwnProperty('mass')){oldSIUnit=valueUnitsByBase.mass;}else if(valueUnitsByBase.hasOwnProperty('volume')){oldSIUnit=valueUnitsByBase.volume;}if(oldSIUnit){var newSIValue=math.unit(math.unit(valueNumber+' '+oldSIUnit).format());var newSIUnit=newSIValue.formatUnits();if(newSIUnit!==oldSIUnit){value=math.unit(newSIValue.toNumber()+' '+value.formatUnits().replace(oldSIUnit,newSIUnit));valueNumber=mw.calculators.getValueNumber(value,decimals);valueUnits=mw.calculators.getUnitsString(value);}}}var
valueString=String(valueNumber);if(valueUnits){valueString+=' '+valueUnits;}var unitsId=value.formatUnits();if(mw.calculators.units.hasOwnProperty(unitsId)&&typeof mw.calculators.units[unitsId].formatValue==='function'){valueString=mw.calculators.units[unitsId].formatValue(valueString);}return valueString;},getVariable:function(variableId){if(mw.calculators.variables.hasOwnProperty(variableId)){return mw.calculators.variables[variableId];}else{return null;}},hasData:function(dataType,dataId){if(mw.calculators.hasOwnProperty(dataType)&&mw.calculators[dataType].hasOwnProperty(dataId)){return!0;}else{return!1;}},initialize:function(){$('#nav-article svg').addClass('fa-calculator');$('#nav-article .nav-label').html('Calculator');var descriptionCount=0;$('.calculator-description').each(function(){var descriptionContainerId='calculator-description-info';if(descriptionCount){descriptionContainerId+='-'+descriptionCount;}var $descriptionLinkIcon=$('<i>',{class:
'far fa-question-circle fa-fw'});var descriptionLinkString='';descriptionLinkString+=$(this).data('title')?$(this).data('title'):'About this calculator';var $descriptionLinkLabel=$('<span>',{html:descriptionLinkString});var $descriptionLink=$('<a>',{'data-toggle':'collapse',href:'#'+descriptionContainerId,role:'button','aria-expanded':'false','aria-controls':descriptionContainerId}).append($descriptionLinkIcon,$descriptionLinkLabel);var $descriptionContainer=$('<div>',{id:descriptionContainerId,class:'collapse calculator-description-info',html:$(this).html()});$(this).empty();if(!descriptionCount){$descriptionLink.addClass('dropdown-item');$descriptionLinkLabel.addClass('nav-label');$('#menuButton .dropdown-menu').prepend($descriptionLink);}else{$descriptionLink.addClass('btn btn-outline-primary btn-sm');$(this).append($descriptionLink);}$(this).append($descriptionContainer);descriptionCount++;});mw.calculators.setDefaultOptions();var $optionsElement=$(mw.calculators.selectors.
calculatorOptions);if($optionsElement.length){$.each($optionsElement.data(),function(optionId,value){mw.calculators.setOptionValue(optionId,value);});}mw.hook('calculators.initialized').fire();},isMobile:function(){return window.matchMedia('only screen and (max-width: 760px)').matches;},isValueMathObject:function(value){return value&&value.hasOwnProperty('value');},prepareReferences:function(references){for(var iReference in references){var reference=references[iReference];reference=reference.replace(/(https?:\/\/[^\s]*)/gmi,'<a href="$1" target="_blank">$1</a>');reference=reference.replace(/doi: ([\w\d\.\/-]+)((\.\s)|$)/gmi,'doi: <a href="https://doi.org/$1" target="_blank">$1</a>$2');reference=reference.replace(/PMCID: PMC(\d+)/gmi,'PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC$1/" target="_blank">PMC$1</a>');reference=reference.replace(/PMID: (\d+)/gmi,'PMID: <a href="https://pubmed.ncbi.nlm.nih.gov/$1" target="_blank">$1</a>');references[iReference]=reference;}
return references;},setCookieValue:function(variableId,value){mw.cookie.set(mw.calculators.getCookieKey(variableId),value,{expires:COOKIE_EXPIRATION});},setDefaultOptions:function(){mw.calculators.setOptionValue('inputgroupmaxinputsperrow',3);},setOptionValue:function(optionId,value){mw.calculators.options[optionId]=value;return!0;},setValue:function(variableId,value){if(!mw.calculators.variables.hasOwnProperty(variableId)){return!1;}if(!mw.calculators.variables[variableId].setValue(value)){return!1;}mw.calculators.setCookieValue(variableId,value);return!0;},uniqueValues:function(value,index,self){return self.indexOf(value)===index;}};mw.calculators.objectClasses.CalculatorObject=function(properties,propertyValues){propertyValues=propertyValues?propertyValues:{};if(properties){if(properties.hasOwnProperty('required')){for(var iRequiredProperty in properties.required){var requiredProperty=properties.required[iRequiredProperty];if(!propertyValues||!propertyValues.hasOwnProperty
(requiredProperty)){console.error('Missing required property "'+requiredProperty+'"');console.log(propertyValues);return null;}this[requiredProperty]=propertyValues[requiredProperty];delete propertyValues[requiredProperty];}}if(properties.hasOwnProperty('optional')){for(var iOptionalProperty in properties.optional){var optionalProperty=properties.optional[iOptionalProperty];if(propertyValues&&propertyValues.hasOwnProperty(optionalProperty)){this[optionalProperty]=propertyValues[optionalProperty];delete propertyValues[optionalProperty];}else if(typeof this[optionalProperty]==='undefined'){this[optionalProperty]=null;}}}var invalidProperties=Object.keys(propertyValues);if(invalidProperties.length){console.warn('Unsupported properties defined for '+typeof this+' with id "'+this.id+'": '+invalidProperties.join(', '));}}};mw.calculators.objectClasses.CalculatorObject.prototype.getProperties=function(){return{required:[],optional:[]};};mw.calculators.objectClasses.CalculatorObject.prototype.
mergeProperties=function(inheritedProperties,properties){var uniqueValues=function(value,index,self){return self.indexOf(value)===index;};properties.required=inheritedProperties.required.concat(properties.required).filter(uniqueValues);properties.optional=inheritedProperties.optional.concat(properties.optional).filter(uniqueValues);return properties;};mw.calculators.objectClasses.UnitsBase=function(propertyValues){var properties={required:['id'],optional:['toString']};mw.calculators.objectClasses.CalculatorObject.call(this,properties,propertyValues);};mw.calculators.objectClasses.UnitsBase.prototype=Object.create(mw.calculators.objectClasses.CalculatorObject.prototype);mw.calculators.objectClasses.Units=function(propertyValues){var properties={required:['id'],optional:['aliases','baseName','definition','formatValue','offset','prefixes']};mw.calculators.objectClasses.CalculatorObject.call(this,properties,propertyValues);};mw.calculators.objectClasses.Units.prototype=Object.create(mw.
calculators.objectClasses.CalculatorObject.prototype);mw.calculators.objectClasses.Variable=function(propertyValues){mw.calculators.objectClasses.CalculatorObject.call(this,this.getProperties(),propertyValues);if(VALID_TYPES.indexOf(this.type)===-1){throw new Error('Invalid type "'+this.type+'" for variable "'+this.id+'"');}if(Array.isArray(this.options)){var options={};for(var iOption in this.options){var option=this.options[iOption];options[option]=option;}this.options=options;}this.calculations=[];if(this.defaultValue){this.defaultValue=this.prepareValue(this.defaultValue);}if(this.minValue){this.minValue=this.prepareValue(this.minValue);}if(this.maxValue){this.maxValue=this.prepareValue(this.maxValue);}this.message=null;this.valid=!0;this.isValueSet=!1;this.value=null;};mw.calculators.objectClasses.Variable.prototype=Object.create(mw.calculators.objectClasses.CalculatorObject.prototype);mw.calculators.objectClasses.Variable.prototype.addCalculation=function(calculationId){if(
this.calculations.indexOf(calculationId)!==-1){return;}this.calculations.push(calculationId);};mw.calculators.objectClasses.Variable.prototype.createInput=function(inputOptions){if(!inputOptions){inputOptions={};}inputOptions.class=inputOptions.hasOwnProperty('class')?inputOptions.class:'';inputOptions.global=inputOptions.hasOwnProperty('class')?inputOptions.global:!1;inputOptions.hideLabel=inputOptions.hasOwnProperty('hideLabel')?inputOptions.hideLabel:!1;inputOptions.hideLabelMobile=inputOptions.hasOwnProperty('hideLabelMobile')?inputOptions.hideLabelMobile:!1;inputOptions.inline=inputOptions.hasOwnProperty('inline')?inputOptions.inline:!1;inputOptions.inputClass=inputOptions.hasOwnProperty('inputClass')?inputOptions.inputClass:'';var variableId=this.id;var inputId='calculator-input-'+variableId;if(!inputOptions.global){var inputIdCount=0;while($('#'+inputId+'-'+inputIdCount).length){inputIdCount++;}inputId+='-'+inputIdCount;}var inputContainerTag=inputOptions.inline?
'<span>':'<div>';var inputContainerAttributes={class:'form-group mb-0 calculator-container-input'};inputContainerAttributes.class+=inputOptions.class?' '+inputOptions.class:'';inputContainerAttributes.class+=' calculator-container-input-'+variableId;var inputContainerCss={};var labelAttributes={for:inputId,html:this.getLabelString()};if(inputOptions.hideLabel||(inputOptions.hideLabelMobile&&mw.calculators.isMobile())){labelAttributes.class='sr-only';}var labelCss={};if(inputOptions.inline){inputContainerTag='<span>';inputContainerCss['align-items']='center';inputContainerCss['display']='flex';labelAttributes.html+=':&nbsp;';labelCss['margin-bottom']=0;}var $inputContainer=$(inputContainerTag,inputContainerAttributes).css(inputContainerCss);var $label=$('<label>',labelAttributes).css(labelCss);$inputContainer.append($label);var variable=this;var value=this.getValue();if(this.type===TYPE_NUMBER){var unitsId=null;var $unitsContainer=null;var inputValue='';if(mw.calculators.
isValueMathObject(value)){var number=value.toNumber();if(number){inputValue=number;}}else{inputValue=value;}var inputAttributes={id:inputId,class:'form-control form-control-sm calculator-input calculator-input-text',type:'text',autocomplete:'off',inputmode:'decimal',value:inputValue};if(this.maxLength){inputAttributes.maxlength=this.maxLength;}inputAttributes.class+=inputOptions.inputClass?' '+inputOptions.inputClass:'';inputAttributes.class+=' '+inputId;if(this.hasUnits()){unitsId=inputId+'-units';var unitsValue=mw.calculators.isValueMathObject(value)?value.formatUnits():null;var unitsInputAttributes={id:unitsId};$unitsContainer=$('<div>',{class:'input-group-append'}).css('align-items','center');if(this.units.length===1){unitsInputAttributes.type='hidden';unitsInputAttributes.value=this.units[0];$unitsContainer.css('padding','0 0.5em').append(mw.calculators.getUnitsString(math.unit('0 '+this.units[0]))).append($('<input>',unitsInputAttributes));}else{unitsInputAttributes.class=
'custom-select custom-select-sm calculator-input-select';unitsInputAttributes.class+=inputOptions.inputClass?' '+inputOptions.inputClass:'';unitsInputAttributes.class=unitsInputAttributes.class+' '+unitsId;var $unitsInput=$('<select>',unitsInputAttributes).on('change',function(){var numberValue=$('#'+inputId).val();var newValue=numberValue?numberValue+' '+$(this).val():null;if(!mw.calculators.setValue(variableId,newValue)){if(variable.message){$(this).parent().parent().parent().find('.invalid-feedback').html(variable.message);}$(this).parent().parent().addClass('is-invalid');}else{$(this).parent().parent().removeClass('is-invalid');}});for(var iUnits in this.units){var units=this.units[iUnits];var unitsOptionAttributes={html:mw.calculators.getUnitsString(math.unit('0 '+units)),value:units};if(units===unitsValue){unitsOptionAttributes.selected=!0;}$unitsInput.append($('<option>',unitsOptionAttributes));}$unitsContainer.append($unitsInput);}}var $input=$('<input>',inputAttributes).on(
'input',function(){var numberValue=$(this).val();var newValue=numberValue?numberValue:null;if(newValue&&unitsId){newValue=newValue+' '+$('#'+unitsId).val();}if(!mw.calculators.setValue(variableId,newValue)){if(variable.message){$(this).parent().parent().find('.invalid-feedback').html(variable.message);}$(this).parent().addClass('is-invalid');}else{$(this).parent().removeClass('is-invalid');}});var $inputGroup=$('<div>',{class:'input-group'}).append($input);if($unitsContainer){$inputGroup.append($unitsContainer);}$inputContainer.append($inputGroup);}else if(this.type===TYPE_STRING){if(this.hasOptions()){var optionKeys=Object.keys(this.options);if(optionKeys.length===1){$inputContainer.append(this.options[optionKeys[0]]);}else{var selectAttributes={id:inputId,class:'custom-select custom-select-sm calculator-input calculator-input-select'};selectAttributes.class+=inputOptions.inputClass?' '+inputOptions.inputClass:'';var $select=$('<select>',selectAttributes).on('change',function(){if(!mw
.calculators.setValue(variableId,$(this).val())){if(variable.message){$(this).parent().parent().find('.invalid-feedback').html(variable.message);}$(this).parent().addClass('is-invalid');}else{$(this).parent().removeClass('is-invalid');}});for(var optionId in this.options){var displayText=this.options[optionId];var optionAttributes={value:optionId,text:displayText};if(optionId==value){optionAttributes.selected=!0;}$select.append($('<option>',optionAttributes));}$inputContainer.append($select);}}}if($inputContainer.length){$inputContainer.append($('<div>',{class:'invalid-feedback'}));}return $inputContainer;};mw.calculators.objectClasses.Variable.prototype.getLabelString=function(){return mw.calculators.isMobile()&&this.abbreviation?this.abbreviation:this.name;};mw.calculators.objectClasses.Variable.prototype.getProperties=function(){return{required:['id','name','type'],optional:['abbreviation','defaultValue','maxLength','maxValue','minValue','options','units']};};mw.calculators.
objectClasses.Variable.prototype.getValue=function(){if(!this.valid){return null;}else if(this.value!==null){return this.value;}else if(!this.isValueSet&&this.defaultValue!==null){return this.defaultValue;}else{return null;}};mw.calculators.objectClasses.Variable.prototype.getValueString=function(){return String(this.getValue());};mw.calculators.objectClasses.Variable.prototype.hasOptions=function(){return this.options!==null;};mw.calculators.objectClasses.Variable.prototype.hasUnits=function(){return this.units!==null;};mw.calculators.objectClasses.Variable.prototype.hasValue=function(){var value=this.getValue();if(value===null||(mw.calculators.isValueMathObject(value)&&!value.toNumber())){return!1;}return!0;};mw.calculators.objectClasses.Variable.prototype.isValueMathObject=function(){return mw.calculators.isValueMathObject(this.value);};mw.calculators.objectClasses.Variable.prototype.prepareValue=function(value){if(value!==null){if(this.type===TYPE_NUMBER){if(!mw.calculators.
isValueMathObject(value)){value=math.unit(value);}}}return value;};mw.calculators.objectClasses.Variable.prototype.setValue=function(value){this.isValueSet=!0;var validateResult=this.validateValue(value);this.valid=!!validateResult.valid;this.message=validateResult.message;if(!this.valid){this.value=null;this.valueUpdated();return!1;}this.value=this.prepareValue(value);this.valueUpdated();return!0;};mw.calculators.objectClasses.Variable.prototype.toString=function(){return this.getLabelString();};mw.calculators.objectClasses.Variable.prototype.validateValue=function(value){result={message:null,valid:!0};if(value===null){return result;}var consoleWarnPrefix='Could not set value "'+value+'" for "'+this.id+'":';if(this.type===TYPE_NUMBER){if(!mw.calculators.isValueMathObject(value)){value=math.unit(value);}var valueUnits;if(this.hasUnits()){valueUnits=value.formatUnits().replace(/\s/g,'');if(!valueUnits){result.valid=!1;console.warn(consoleWarnPrefix+'Value must define units')
;}else if(this.units.indexOf(valueUnits)===-1){result.valid=!1;console.warn(consoleWarnPrefix+'Units "'+valueUnits+'" are not valid for this variable');}}if(this.minValue&&math.smaller(value,this.minValue)){var minValueString=mw.calculators.getValueString(this.minValue);if(valueUnits&&valueUnits!=this.minValue.formatUnits()){minValueString+=' ('+mw.calculators.getValueString(this.minValue.to(valueUnits))+')';}result.message=String(this)+' must be at least '+minValueString;result.valid=!1;}else if(this.maxValue&&math.larger(value,this.maxValue)){var maxValueString=mw.calculators.getValueString(this.maxValue);if(valueUnits&&valueUnits!=this.maxValue.formatUnits()){maxValueString+=' ('+mw.calculators.getValueString(this.maxValue.to(valueUnits))+')';}result.message=String(this)+' must be less than '+maxValueString;result.valid=!1;}}else if(this.hasOptions()){if(!this.options.hasOwnProperty(value)){result.valid=!1;console.warn(consoleWarnPrefix+'Value must be one of: '+Object.
keys(this.options).join(', '));}}return result;};mw.calculators.objectClasses.Variable.prototype.valueUpdated=function(){for(var iCalculation in this.calculations){var calculation=mw.calculators.getCalculation(this.calculations[iCalculation]);if(calculation){calculation.update();}}};mw.calculators.objectClasses.AbstractCalculation=function(propertyValues){mw.calculators.objectClasses.CalculatorObject.call(this,this.getProperties(),propertyValues);this.initialize();};mw.calculators.objectClasses.AbstractCalculation.prototype=Object.create(mw.calculators.objectClasses.CalculatorObject.prototype);mw.calculators.objectClasses.AbstractCalculation.prototype.addCalculation=function(calculationId){if(this.calculations.indexOf(calculationId)!==-1){return;}this.calculations.push(calculationId);};mw.calculators.objectClasses.AbstractCalculation.prototype.doRender=function(){throw new Error('AbstractCalculation child class "'+this.getClassName()+'" must implement doRender()');};mw.calculators.
objectClasses.AbstractCalculation.prototype.getCalculationData=function(){return this.data;};mw.calculators.objectClasses.AbstractCalculation.prototype.getCalculationDataValues=function(){var calculationData=this.getCalculationData();var missingRequiredData=this.getMissingRequiredData();if(missingRequiredData.length){this.message=missingRequiredData.join(', ')+' required';return!1;}var data={};var calculationId,calculation,variableId,variable;var calculations=calculationData.calculations.required.concat(calculationData.calculations.optional);for(var iRequiredCalculation in calculations){calculationId=calculations[iRequiredCalculation];calculation=mw.calculators.getCalculation(calculationId);data[calculationId]=calculation.value;}var variables=calculationData.variables.required.concat(calculationData.variables.optional);for(var iRequiredVariable in variables){variableId=variables[iRequiredVariable];variable=mw.calculators.getVariable(variableId);data[variableId]=variable.getValue();}
return data;};mw.calculators.objectClasses.AbstractCalculation.prototype.getClassName=function(){throw new Error('AbstractCalculation child class must implement getClassName()');};mw.calculators.objectClasses.AbstractCalculation.prototype.getContainerClasses=function(){return this.getElementClasses();};mw.calculators.objectClasses.AbstractCalculation.prototype.getContainerId=function(){return this.getElementPrefix()+'-'+this.id;};mw.calculators.objectClasses.AbstractCalculation.prototype.getDescription=function(){return this.description;};mw.calculators.objectClasses.AbstractCalculation.prototype.getElementPrefix=function(useClassName){var elementPrefix='calculator-';elementPrefix+=useClassName?this.getClassName():'calculation';return elementPrefix;};mw.calculators.objectClasses.AbstractCalculation.prototype.getElementClasses=function(elementId){elementId=elementId?'-'+elementId:'';return this.getElementPrefix()+elementId+' '+this.getElementPrefix(!0)+elementId+' '+this.
getContainerId()+elementId;};mw.calculators.objectClasses.AbstractCalculation.prototype.getFormula=function(){return this.formula;};mw.calculators.objectClasses.AbstractCalculation.prototype.getInfo=function(infoCount){var infoHtml='';var description=this.getDescription();if(description){infoHtml+=$('<p>',{html:description})[0].outerHTML;}var formula=this.getFormula();if(formula){infoHtml+=$('<div>',{class:this.getElementClasses('formula')})[0].outerHTML;}var references=this.getReferences();if(references.length){var $references=$('<ol>');for(var iReference in references){$references.append($('<li>',{html:references[iReference]}));}infoHtml+=$('<div>',{class:this.getElementClasses('references')}).append($references)[0].outerHTML;}var infoContainerId=this.getContainerId()+'-info';if(infoCount){infoContainerId+='-'+infoCount;}$infoContainer=$('<div>',{id:infoContainerId,class:'collapse row no-gutters border-top '+this.getElementClasses('info')}).append(infoHtml);return $infoContainer;};mw
.calculators.objectClasses.AbstractCalculation.prototype.getInfoButton=function(infoCount){var infoContainerId=this.getContainerId()+'-info';if(infoCount){infoContainerId+='-'+infoCount;}return $('<span>',{class:this.getElementClasses('infoButton')}).append($('<a>',{'data-toggle':'collapse',href:'#'+infoContainerId,role:'button','aria-expanded':'false','aria-controls':infoContainerId}).append($('<i>',{class:'far fa-question-circle'})));};mw.calculators.objectClasses.AbstractCalculation.prototype.getMissingRequiredData=function(){var calculationData=this.getCalculationData();var missingRequiredData=[];var calculation,variable;for(var iRequiredCalculation in calculationData.calculations.required){calculation=mw.calculators.getCalculation(calculationData.calculations.required[iRequiredCalculation]);if(!calculation.hasValue()){missingRequiredData=missingRequiredData.concat(calculation.getMissingRequiredData());}}for(var iRequiredVariable in calculationData.variables.required){variable=mw.
calculators.getVariable(calculationData.variables.required[iRequiredVariable]);if(!variable.hasValue()){missingRequiredData.push(String(variable));}}return missingRequiredData.filter(mw.calculators.uniqueValues);};mw.calculators.objectClasses.AbstractCalculation.prototype.getProperties=function(){return{required:['id','calculate'],optional:['data','description','formula','onRender','onRendered','references','searchData','type']};};mw.calculators.objectClasses.AbstractCalculation.prototype.getReferences=function(){return this.references;};mw.calculators.objectClasses.AbstractCalculation.prototype.getSearchString=function(){var searchString=this.id;searchString+=this.searchData?' '+this.searchData:'';return searchString.trim();};mw.calculators.objectClasses.AbstractCalculation.prototype.getTitleHtml=function(){return this.getTitleString();};mw.calculators.objectClasses.AbstractCalculation.prototype.getTitleString=function(){return this.id;};mw.calculators.objectClasses.
AbstractCalculation.prototype.getValue=function(){this.recalculate();return this.value;};mw.calculators.objectClasses.AbstractCalculation.prototype.hasInfo=function(){return this.getDescription()||this.getFormula()||this.getReferences().length;};mw.calculators.objectClasses.AbstractCalculation.prototype.hasValue=function(){if(this.value===null||(this.isValueMathObject()&&!this.value.toNumber())){return!1;}return!0;};mw.calculators.objectClasses.AbstractCalculation.prototype.initialize=function(){if(typeof this.calculate!=='function'){throw new Error('calculate() must be a function for Calculation "'+this.id+'"');}this.calculations=[];this.data=new mw.calculators.objectClasses.CalculationData(this.getCalculationData());this.references=this.references?mw.calculators.prepareReferences(this.references):[];this.type=this.type?this.type:TYPE_NUMBER;this.message=null;this.value=null;$('.'+this.getContainerId()).empty();};mw.calculators.objectClasses.AbstractCalculation.prototype.
isValueMathObject=function(){return mw.calculators.isValueMathObject(this.value);};mw.calculators.objectClasses.AbstractCalculation.prototype.parseFormula=function(){var formula=this.getFormula();if(!formula){return;}var api=new mw.Api();var containerId=this.getContainerId()+'-formula';api.parse(formula).then(function(result){$('.'+containerId).html(result);});};mw.calculators.objectClasses.AbstractCalculation.prototype.recalculate=function(){this.message='';this.value=null;var data=this.getCalculationDataValues();if(data===!1){this.valueUpdated();return!1;}try{var value=this.calculate(data);if(this.type===TYPE_NUMBER&&!isNaN(value)){if(this.units){value=value+' '+this.units;}this.value=math.unit(value);}else{this.value=value;}}catch(e){console.warn(e.message);this.message=e.message;this.value=null;}finally{this.valueUpdated();}return!0;};mw.calculators.objectClasses.AbstractCalculation.prototype.render=function(){var calculation=this;setTimeout(function(){if(typeof calculation
.onRender==='function'){calculation.onRender();}calculation.doRender();calculation.parseFormula();mw.track('mw.calculators.CalculationRendered');if(typeof calculation.onRendered==='function'){calculation.onRendered();}},0);};mw.calculators.objectClasses.AbstractCalculation.prototype.setDependencies=function(){this.data=this.getCalculationData();var calculationIds=this.data.calculations.required.concat(this.data.calculations.optional);for(var iCalculationId in calculationIds){var calculationId=calculationIds[iCalculationId];if(!mw.calculators.calculations.hasOwnProperty(calculationId)){throw new Error('Calculation "'+calculationId+'" does not exist for calculation "'+this.id+'"');}mw.calculators.calculations[calculationId].addCalculation(this.id);}var variableIds=this.data.variables.required.concat(this.data.variables.optional);for(var iVariableId in variableIds){var variableId=variableIds[iVariableId];if(!mw.calculators.variables.hasOwnProperty(variableId)){throw new Error('Variable "'
+variableId+'" does not exist for calculation "'+this.id+'"');}mw.calculators.variables[variableId].addCalculation(this.id);}this.recalculate();};mw.calculators.objectClasses.AbstractCalculation.prototype.toString=function(){return this.getTitleString();};mw.calculators.objectClasses.AbstractCalculation.prototype.update=function(){this.recalculate();this.render();};mw.calculators.objectClasses.AbstractCalculation.prototype.valueUpdated=function(){for(var iCalculation in this.calculations){calculation=mw.calculators.getCalculation(this.calculations[iCalculation]);if(calculation){calculation.update();}}};mw.calculators.objectClasses.CalculationData=function(propertyValues){mw.calculators.objectClasses.CalculatorObject.call(this,this.getProperties(),propertyValues);var dataTypes=this.getDataTypes();var dataRequirements=this.getDataRequirements();for(var iDataType in dataTypes){var dataType=dataTypes[iDataType];if(!this[dataType]){this[dataType]={optional:[],required:[]};}else{for(var
iDataRequirement in dataRequirements){var dataRequirement=dataRequirements[iDataRequirement];if(!this[dataType].hasOwnProperty(dataRequirement)){this[dataType][dataRequirement]=[];}}}}};mw.calculators.objectClasses.CalculationData.prototype=Object.create(mw.calculators.objectClasses.CalculatorObject.prototype);mw.calculators.objectClasses.CalculationData.prototype.getDataRequirements=function(){return['optional','required'];};mw.calculators.objectClasses.CalculationData.prototype.getDataTypes=function(){return['calculations','variables'];};mw.calculators.objectClasses.CalculationData.prototype.getProperties=function(){return{required:[],optional:['calculations','variables']};};mw.calculators.objectClasses.CalculationData.prototype.merge=function(){var mergedData=new mw.calculators.objectClasses.CalculationData();var data=[this].concat(Array.prototype.slice.call(arguments));var dataTypes=this.getDataTypes();for(var iData in data){for(var iDataType in dataTypes){var dataType=dataTypes[
iDataType];mergedData[dataType].required=mergedData[dataType].required.concat(data[iData][dataType].required).filter(mw.calculators.uniqueValues);mergedData[dataType].optional=mergedData[dataType].optional.concat(data[iData][dataType].optional).filter(mw.calculators.uniqueValues);}}return mergedData;};mw.calculators.objectClasses.SimpleCalculation=function(propertyValues){mw.calculators.objectClasses.CalculatorObject.call(this,this.getProperties(),propertyValues);this.initialize();};mw.calculators.objectClasses.SimpleCalculation.prototype=Object.create(mw.calculators.objectClasses.AbstractCalculation.prototype);mw.calculators.objectClasses.SimpleCalculation.prototype.doRender=function(){var $calculationContainer=$('.'+this.getContainerId());if(!$calculationContainer.length){return;}$calculationContainer.addClass('row no-gutters border '+this.getContainerClasses());$calculationContainer.attr('data-search',this.getSearchString());var valueString=this.getValueString();var inputVariableIds
=this.data.variables.required.concat(this.data.variables.optional);var missingVariableInputs=[];for(var iInputVariableId in inputVariableIds){var variableId=inputVariableIds[iInputVariableId];if(!$('#calculator-input-'+variableId).length){missingVariableInputs.push(variableId);}}var titleColumns='7';var valueColumns='5';var calculation=this;var calculationCount=0;$calculationContainer.each(function(){var elementTypes=['title','variables','value','info'];var elements={};for(var iElementType in elementTypes){var elementType=elementTypes[iElementType];elements[elementType]={$container:null,id:calculation.getContainerId()+'-'+elementType};if(calculationCount){elements[elementType].id+='-'+calculationCount;}}elements.title.$container=$('<div>',{id:elements.title.id});elements.title.$container.append(calculation.getTitleHtml());if(calculation.hasInfo()){elements.title.$container.append(calculation.getInfoButton(calculationCount));elements.info.$container=calculation.getInfo();}elements.value
.$container=$('<div>').append(valueString);if(!missingVariableInputs.length){elements.title.$container.addClass('col-'+titleColumns+' border-right');elements.value.$container.attr('id',elements.value.id);elements.value.$container.addClass('col-'+valueColumns);}else{elements.title.$container.addClass('col-12 border-bottom');elements.value.$container.addClass('col-12');elements.variables.$container=$('<div>',{class:'row no-gutters border-bottom '+calculation.getElementClasses('variables'),id:elements.variables.id}).append($('<div>',{class:'col-12'}).append(mw.calculators.createInputGroup(missingVariableInputs)));elements.value.$container=$('<div>',{class:'row no-gutters',id:elements.value.id}).append(elements.value.$container);}elements.title.$container.addClass(calculation.getElementClasses('title'));elements.value.$container.addClass(calculation.getElementClasses('value'));for(var iElementType in elementTypes){var elementType=elementTypes[iElementType];var $existingContainer=$('#'+
elements[elementType].id);if($existingContainer.length){if(!$.contains($existingContainer[0],$(':focus')[0])){$existingContainer.replaceWith(elements[elementType].$container);}}else{$(this).append(elements[elementType].$container);}}calculationCount++;});};mw.calculators.objectClasses.SimpleCalculation.prototype.getClassName=function(){return'SimpleCalculation';};mw.calculators.objectClasses.SimpleCalculation.prototype.getProperties=function(){var inheritedProperties=mw.calculators.objectClasses.AbstractCalculation.prototype.getProperties();return this.mergeProperties(inheritedProperties,{required:['name'],optional:['abbreviation','digits','link','units']});};mw.calculators.objectClasses.SimpleCalculation.prototype.getSearchString=function(){return(this.id+' '+this.abbreviation+' '+this.name+' '+this.searchData).trim();};mw.calculators.objectClasses.SimpleCalculation.prototype.getTitleHtml=function(){var titleHtml=this.getTitleString();if(this.link){var href=this.link;var matches=href.
match(/\[\[(.*?)\]\]/);if(matches){href=mw.util.getUrl(matches[1]);}titleHtml=$('<a>',{href:href,text:titleHtml})[0].outerHTML;}return titleHtml;};mw.calculators.objectClasses.SimpleCalculation.prototype.getTitleString=function(){return mw.calculators.isMobile()&&this.abbreviation?this.abbreviation:this.name;};mw.calculators.objectClasses.SimpleCalculation.prototype.getValueString=function(){if(this.message){return this.message;}else if(typeof this.value==='object'&&this.value.hasOwnProperty('value')){return mw.calculators.getValueString(this.value);}else{return String(this.value);}};mw.calculators.initialize();}());},{"css":[
".form-control-sm,.custom-select-sm{font-size:16px;transform:scale(0.875);transform-origin:left top;margin-right:-10%}.calculator,.calculator-calculation{font-size:0.875rem !important}.calculator-calculation{background:#f9fcff;margin-bottom:0.5rem}.calculator-calculation .calculator-calculation-info{flex-direction:column}.calculator-calculation .collapsing{-webkit-transition:none;transition:none;display:none}.calculator-calculation .btn{font-size:inherit !important}.calculation-infobox{padding:0 !important}.calculator-inputGroup{flex-wrap:nowrap;margin:0}@media only screen and (max-width:529px){.calculator-input-text{padding-right:0.5rem;padding-left:0.5rem}}@media only screen and (max-width:529px){.calculator-input-select{padding-right:1.5rem;padding-left:0.5rem}}.calculator-description-info{border-bottom:1px solid #dee2e6;padding:0.5rem 0rem}@media (max-width:767px){.calculator-hideLabelMobile{display:block;position:absolute;clip:rect(1px,1px,1px,1px);width:1px;height:1px;margin:-1px;border:0;padding:0;overflow:hidden}}.calculator-SimpleCalculation{width:100%;max-width:600px}.calculator-SimpleCalculation .row{width:100%}.calculator-SimpleCalculation .calculator-calculation-title{background:rgba(0,0,0,0.03);font-weight:500;padding:0.2rem 0.4rem}.calculator-SimpleCalculation .calculator-calculation-value{font-weight:500;padding:0.2rem 0.4rem;text-align:right}.calculator-SimpleCalculation .calculator-calculation-variables{padding:0.4rem 1rem !important}.calculator-SimpleCalculation .calculator-calculation-variables .form-group{margin-bottom:0.5rem}.calculator-SimpleCalculation .calculator-calculation-infoButton{float:right}.calculator-SimpleCalculation .calculator-calculation-info{padding:0.4rem 1rem !important}.calculator-SimpleCalculation .calculator-calculation-info ol,.calculator-SimpleCalculation .calculator-calculation-info ul{margin:0 0 0 1rem}.calculator-SimpleCalculation .calculator-calculation-formula p{margin-bottom:0}"
]});mw.loader.implement("ext.gadget.calculator-neuro@12zfz",function($,jQuery,require,module){(function(){mw.calculators.addUnitsBases({temperature:{toString:function(units){units=units.replace('deg','&deg;');return units;}}});var gcsEyeResponseOptions=['Not testable','No eye opening','To pain','To voice','Spontaneous'];var gcsVerbalResponseOptions=['Not testable','Makes no sounds','Incomprehensible sounds','Inappropriate words','Confused','Oriented'];var gcsMotorResponseOptions=['Not testable','No movements','Extension to pain','Flexion to pain','Withdrawal from pain','Localizes Pain','Obeys commands'];var avmEloquenceOfAdjacentBrainOptions=['Non-eloquent','Eloquent'];var avmVenousDrainageOptions=['Superficial veins only','Deep veins'];var avmRupturedPresentationOptions=['Unruptured','Ruptured'];var avmNidusCompactnessOptions=['Compact','Diffuse'];mw.calculators.addVariables({paCO2:{name:'PaCO<sub>2</sub>',type:'number',abbreviation:'PaCO<sub>2</sub>',minValue:'20 mmHg',defaultValue:
'40 mmHg',maxLength:3,units:['mmHg']},temperature:{name:'Temperature',type:'number',abbreviation:'Temp',minValue:'20 degC',maxValue:'44 degC',defaultValue:'37 degC',maxLength:5,units:['degC','degF']},gcsEyeResponse:{name:'Eye response',type:'string',abbreviation:'Eye',defaultValue:'Not testable',options:gcsEyeResponseOptions},gcsVerbalResponse:{name:'Verbal response',type:'string',abbreviation:'Verbal',defaultValue:'Not testable',options:gcsVerbalResponseOptions},gcsMotorResponse:{name:'Motor response',type:'string',abbreviation:'Motor',defaultValue:'Not testable',options:gcsMotorResponseOptions},avmSize:{name:'AVM Size',type:'number',minValue:'0.1 cm',maxValue:'20 cm',abbreviation:'AVM size',defaultValue:'1 cm',units:['cm']},avmEloquenceOfAdjacentBrain:{name:'Eloquence of adjacent brain',type:'string',abbreviation:'Eloquence',defaultValue:'Non-eloquent',options:avmEloquenceOfAdjacentBrainOptions},avmVenousDrainage:{name:'Venous drainage',type:'string',abbreviation:'Venous drainage',
defaultValue:'Superficial veins only',options:avmVenousDrainageOptions},avmRupturedPresentation:{name:'Ruptured presentation',type:'string',abbreviation:'Ruptured',defaultValue:'No',options:avmRupturedPresentationOptions},avmNidusCompactness:{name:'Nidus compactness',type:'string',abbreviation:'Compactness',defaultValue:'No',options:avmNidusCompactnessOptions}});mw.calculators.addCalculations({brainMass:{name:'Brain mass',data:{variables:{optional:['age','gender']}},digits:0,units:'gwt',description:'This calculation will give a more precise estimate of brain mass if age and/or sex are provided.',references:['Dekaban AS. Changes in brain weights during the span of human life: relation of brain weights to body heights and body weights. Ann Neurol. 1978 Oct;4(4):345-56. doi: 10.1002/ana.410040410. PMID: 727739.'],calculate:function(data){var age=data.age?data.age.toNumber('yr'):null;var gender=data.gender?data.gender:null;var brainMassFemale=1290;var brainMassMale=1450;if(age!==null){if(
age<=10/365){brainMassFemale=360;brainMassMale=380;}else if(age<=4*30/365){var ageFactor=1-(4*30/365-age)/(4*30/365-10/365);brainMassFemale=360+ageFactor*(580-360);brainMassMale=380+ageFactor*(640-380);}else if(age<=8*30/365){brainMassFemale=580;brainMassMale=640;}else if(age<=18*30/365){brainMassFemale=940;brainMassMale=970;}else if(age<=30*30/365){brainMassFemale=1040;brainMassMale=1120;}else if(age<=43*30/365){brainMassFemale=1090;brainMassMale=1270;}else if(age<=5){brainMassFemale=1150;brainMassMale=1300;}else if(age<=7){brainMassFemale=1210;brainMassMale=1330;}else if(age<=9){brainMassFemale=1180;brainMassMale=1370;}else if(age<=12){brainMassFemale=1260;brainMassMale=1440;}else if(age<=15){brainMassFemale=1280;brainMassMale=1410;}else if(age<=18){brainMassFemale=1340;brainMassMale=1440;}else if(age<=21){brainMassFemale=1310;brainMassMale=1450;}else if(age<=30){brainMassFemale=1300;brainMassMale=1440;}else if(age<=40){brainMassFemale=1290;brainMassMale=1440;}else if(age<=50){
brainMassFemale=1290;brainMassMale=1430;}else if(age<=55){brainMassFemale=1280;brainMassMale=1410;}else if(age<=60){brainMassFemale=1250;brainMassMale=1370;}else if(age<=65){brainMassFemale=1240;brainMassMale=1370;}else if(age<=70){brainMassFemale=1240;brainMassMale=1360;}else if(age<=75){brainMassFemale=1230;brainMassMale=1350;}else if(age<=80){brainMassFemale=1190;brainMassMale=1330;}else if(age<=85){brainMassFemale=1170;brainMassMale=1310;}else{brainMassFemale=1140;brainMassMale=1290;}}if(gender==='F'){return brainMassFemale;}else if(gender==='M'){return brainMassMale;}else{return(brainMassFemale+brainMassMale)/2;}}},cerebralBloodVolume:{name:'Cerebral blood volume',abbreviation:'CBV',data:{calculations:{required:['brainMass']}},units:'mL',description:'4 mL per 100g of brain mass',references:['Tameem A, Krovvidi H, Cerebral physiology, Continuing Education in Anaesthesia Critical Care & Pain, Volume 13, Issue 4, August 2013, Pages 113–118, https://doi.org/10.1093/bjaceaccp/mkt001'
],calculate:function(data){var brainMass=data.brainMass.toNumber('gwt');return 4*brainMass/100;}},cerebralMetabolicRateFactor:{name:'Cerebral metabolic rate factor',abbreviation:'%CMR',data:{variables:{optional:['temperature']}},description:'7% change in CMR for every 1 &deg;C change in temperature',references:['Tameem A, Krovvidi H, Cerebral physiology, Continuing Education in Anaesthesia Critical Care & Pain, Volume 13, Issue 4, August 2013, Pages 113–118, https://doi.org/10.1093/bjaceaccp/mkt001'],calculate:function(data){var temperature=data.temperature?data.temperature.toNumber('degC'):null;var cerebralMetabolicRateFactor=1;if(temperature){cerebralMetabolicRateFactor+=0.07*(temperature-37);}return cerebralMetabolicRateFactor;}},cerebralMetabolicRateO2:{name:'Cerebral metabolic rate (O<sub>2</sub>)',abbreviation:'CMRO<sub>2</sub>',data:{calculations:{required:['brainMass','cerebralMetabolicRateFactor']},variables:{optional:['temperature']}},units:'mL/min',description:
'<ul><li>3 mL O<sub>2</sub>/min per 100g of brain mass</li><li>If temperature is provided, adjusts estimate using 7% change in CMR for every 1 &deg;C change in temperature</li></ul>',references:['Tameem A, Krovvidi H, Cerebral physiology, Continuing Education in Anaesthesia Critical Care & Pain, Volume 13, Issue 4, August 2013, Pages 113–118, https://doi.org/10.1093/bjaceaccp/mkt001'],searchData:'cmro2',calculate:function(data){var brainMass=data.brainMass.toNumber('gwt');var cerebralMetabolicRateFactor=data.cerebralMetabolicRateFactor.toNumber();return cerebralMetabolicRateFactor*3*brainMass/100;}},cerebralMetabolicRateGlucose:{name:'Cerebral metabolic rate (Glucose)',abbreviation:'CMR<sub>glu</sub>',data:{calculations:{required:['brainMass','cerebralMetabolicRateFactor']}},units:'mg/min',description:'<ul><li>5 mg glucose/min per 100g of brain mass</li><li>7% change in CMR for every 1 &deg;C change in temperature</li></ul>',references:[
'Tameem A, Krovvidi H, Cerebral physiology, Continuing Education in Anaesthesia Critical Care & Pain, Volume 13, Issue 4, August 2013, Pages 113–118, https://doi.org/10.1093/bjaceaccp/mkt001'],calculate:function(data){var brainMass=data.brainMass.toNumber('gwt');var cerebralMetabolicRateFactor=data.cerebralMetabolicRateFactor.toNumber();return cerebralMetabolicRateFactor*5*brainMass/100;}},cerebralBloodFlow:{name:'Cerebral blood flow',abbreviation:'CBF',data:{calculations:{required:['brainMass','cerebralMetabolicRateFactor']},variables:{optional:['paCO2']}},units:'mL/min',description:'<ul><li>50 mL/min per 100g of brain mass.</li><li>Every mmHg in PaCO2 changes CBF by 1.5 mL/min per 100g of brain mass.</li><li>Cerebral blood flow and cerebral metabolic rate are coupled. Factors that alter CMR (e.g. temperature) will proportionally alter CBF.</li>',references:[
'Tameem A, Krovvidi H, Cerebral physiology, Continuing Education in Anaesthesia Critical Care & Pain, Volume 13, Issue 4, August 2013, Pages 113–118, https://doi.org/10.1093/bjaceaccp/mkt001','Brian JE Jr. Carbon dioxide and the cerebral circulation. Anesthesiology. 1998 May;88(5):1365-86. doi: 10.1097/00000542-199805000-00029. PMID: 9605698.'],calculate:function(data){var brainMass=data.brainMass.toNumber('gwt');var cerebralMetabolicRateFactor=data.cerebralMetabolicRateFactor.toNumber();var paCO2=data.paCO2.toNumber('mmHg');var cerebralBloodFlow=cerebralMetabolicRateFactor*50*brainMass/100;if(paCO2){var minCerebralBloodFlow=cerebralBloodFlow/2;cerebralBloodFlow+=1.5*brainMass/100*(paCO2-40);cerebralBloodFlow=math.max(cerebralBloodFlow,minCerebralBloodFlow);}return cerebralBloodFlow;}},glasgowComaScale:{name:'Glasgow Coma Scale',abbreviation:'Glasgow Coma Scale',data:{variables:{required:['gcsEyeResponse','gcsVerbalResponse','gcsMotorResponse']}},type:'string',references:[
'Teasdale G, Jennett B. Assessment of coma and impaired consciousness. A practical scale. Lancet. 1974 Jul 13;2(7872):81-4. doi: 10.1016/s0140-6736(74)91639-0. PMID: 4136544.'],calculate:function(data){var gcsEyeResponse=gcsEyeResponseOptions.indexOf(data.gcsEyeResponse);var gcsVerbalResponse=gcsVerbalResponseOptions.indexOf(data.gcsVerbalResponse);var gcsMotorResponse=gcsMotorResponseOptions.indexOf(data.gcsMotorResponse);var gcsScore;if(!gcsEyeResponse||!gcsVerbalResponse||!gcsMotorResponse){gcsScore='Cannot be calculated because one or more components are not testable';gcsEyeResponse=gcsEyeResponse?gcsEyeResponse:'NT';gcsVerbalResponse=gcsVerbalResponse?gcsVerbalResponse:'NT';gcsMotorResponse=gcsMotorResponse?gcsMotorResponse:'NT';}else{gcsScore=gcsEyeResponse+gcsVerbalResponse+gcsMotorResponse;}var gcsScale='E('+gcsEyeResponse+') V('+gcsVerbalResponse+') M('+gcsMotorResponse+')';var $gcsResult=$('<div>',{'class':'grid'}).append($('<div>',{'class':'row'}).append($('<div>',{'class':
'col'}).append('Glasgow coma score:'),$('<div>',{'class':'col'}).append(gcsScore)),$('<div>',{'class':'row'}).append($('<div>',{'class':'col'}).append('Glasgow coma scale:'),$('<div>',{'class':'col'}).append(gcsScale)));return $gcsResult.html();}},avmSpetlzerMartinGrade:{name:'Spetlzer-Martin AVM grading scale',abbreviation:'Spetzler-Martin grade',data:{variables:{required:['avmSize','avmEloquenceOfAdjacentBrain','avmVenousDrainage']}},type:'number',calculate:function(data){var avmSize=data.avmSize.toNumber('cm');var avmEloquenceOfAdjacentBrain=data.avmEloquenceOfAdjacentBrain;var avmVenousDrainage=data.avmVenousDrainage;var spetzlerMartinGrade=0;if(avmSize<3){spetzlerMartinGrade+=1;}else if(avmSize<=6){spetzlerMartinGrade+=2;}else{spetzlerMartinGrade+=3;}spetzlerMartinGrade+=avmEloquenceOfAdjacentBrainOptions.indexOf(avmEloquenceOfAdjacentBrain);spetzlerMartinGrade+=avmVenousDrainageOptions.indexOf(avmVenousDrainage);return spetzlerMartinGrade;}},avmSpetzlerMartinGradeRisk:{name:
'Spetlzer-Martin AVM grading scale',abbreviation:'Spetzler-Martin AVM grade',data:{calculations:{required:['avmSpetlzerMartinGrade']},variables:{required:['avmSize','avmEloquenceOfAdjacentBrain','avmVenousDrainage']}},type:'string',description:'<p>The Spetzler-Martin AVM grading system predicts the morbidity/mortality risk of surgery using angiographic features</p><ul><li>Size of nidus<ul><li>0: Small (<3 cm)</li><li>1: Medium (3-6 cm)</li><li>2: Large (>6 cm)</li></ul></li><li>Eloquence of adjacent brain area<ul><li>0: Non-eloquent</li><li>1: Eloquent</li></ul></li><li>Venous drainage<ul><li>0: Superficial veins only</li><li>1: Deep veins</li></ul></li></ul>',references:['Spetzler RF, Martin NA. A proposed grading system for arteriovenous malformations. J Neurosurg. 1986 Oct;65(4):476-83. doi: 10.3171/jns.1986.65.4.0476. PMID: 3760956.'],calculate:function(data){var spetzlerMartinGrade=data.avmSpetlzerMartinGrade.toNumber();var spetzlerMartinGradeRisk=math.roman(spetzlerMartinGrade);
if(spetzlerMartinGrade<=3){spetzlerMartinGradeRisk+=' (low-to-moderate risk)';}else{spetzlerMartinGradeRisk+=' (high-risk)';}return spetzlerMartinGradeRisk;}},avmSupplementalGrade:{name:'Supplemental AVM grading scale',abbreviation:'Supplemental AVM grade',data:{variables:{required:['age','avmRupturedPresentation','avmNidusCompactness']}},type:'number',calculate:function(data){var age=data.age?data.age.toNumber('yr'):0;var avmRupturedPresentation=data.avmRupturedPresentation?data.avmRupturedPresentation:null;var avmNidusCompactness=data.avmNidusCompactness?data.avmNidusCompactness:null;var supplementalGrade=0;if(age<20){supplementalGrade+=1;}else if(age<=40){supplementalGrade+=2;}else{supplementalGrade+=3;}supplementalGrade+=avmRupturedPresentationOptions.indexOf(avmRupturedPresentation);supplementalGrade+=avmNidusCompactnessOptions.indexOf(avmNidusCompactness);return supplementalGrade;}},avmSupplementalGradeRisk:{name:'Supplemental AVM grading scale',abbreviation:
'Supplemental AVM grade',data:{calculations:{required:['avmSupplementalGrade']},variables:{required:['age','avmRupturedPresentation','avmNidusCompactness']}},type:'string',description:'<p>The Supplemental AVM grading system provides additional surgical risk stratification in addition to the Spetzler-Martin grade.</p><ul><li>Age<ul><li>1: <20 yo</li><li>2: 20-40 yo</li><li>3: >40 yo</li></ul></li><li>Ruptured presentation<ul><li>0: Unruptured</li><li>1: Ruptured</li></ul></li><li>Nidus compactness<ul><li>0: Compact</li><li>1: Diffuse</li></ul></li></ul>',references:['Lawton MT, Kim H, McCulloch CE, Mikhak B, Young WL. A supplementary grading scale for selecting patients with brain arteriovenous malformations for surgery. Neurosurgery. 2010 Apr;66(4):702-13; discussion 713. doi: 10.1227/01.NEU.0000367555.16733.E1. PMID: 20190666; PMCID: PMC2847513.'],calculate:function(data){var supplementalGrade=data.avmSupplementalGrade.toNumber();var supplementalGradeRisk=math.roman(supplementalGrade)
;if(supplementalGrade<=3){supplementalGradeRisk+=' (low-to-moderate risk)';}else{supplementalGradeRisk+=' (high-risk)';}return supplementalGradeRisk;}}});}());});mw.loader.implement("ext.gadget.calculator-patients-core@16rtc",function($,jQuery,require,module){(function(){mw.calculators.addUnits({wk:{definition:'0.01923 year',offset:-37},mo:{definition:'1 month'},yr:{definition:'1 year',aliases:['yo']}});mw.calculators.addUnitsBases({weight:{toString:function(units){return units.replace('wt','');}}});mw.calculators.addUnits({gwt:{baseName:'weight',prefixes:'short'},lbwt:{baseName:'weight',definition:'453.59237 gwt'}});mw.calculators.addVariables({age:{name:'Age',type:'number',minValue:'20 wk',maxValue:'125 yr',maxLength:3,units:['yr','mo','wk']},gender:{name:'Sex',type:'string',options:['','F','M']},height:{name:'Height',type:'number',minValue:'20 cm',maxValue:'300 cm',maxLength:3,units:['cm','m','in','ft']},weight:{name:'Weight',type:'number',minValue:'200 gwt',maxValue:'750 kgwt',maxLength:3,units:['kgwt','lbwt','gwt']}});}());});mw.loader.implement("ext.gadget.calculator-patients-patientInput@1eglb",function($,jQuery,require,module){(function(){mw.calculators.renderPatientInput=function(){if(mw.calculators.getOptionValue('patientinputinline')){return;}var containerId='calculator-patients-patientInput';if(!$('#'+containerId).length){var inputs=['weight','height','age','gender'];var $container=$('<div>',{id:containerId});$container.addClass('container border-bottom px-0 py-1');$container.append(mw.calculators.createInputGroup(inputs,!0,inputs.length));$container.appendTo($('#contentHeader'));}};mw.hook('calculators.initialized').add(mw.calculators.renderPatientInput);}());},{"css":["#mw-content-text{margin-top:0 !important}"]});mw.loader.implement("ext.gadget.calculator-search@mwg9l",function($,jQuery,require,module){(function(){mw.calculators.initializeSearch=function(){var $searchContainer=$('#calculator-search');if(!$searchContainer.length){return;}var searchHeading=$searchContainer.data('title')?' '+$searchContainer.data('title'):'Search';var $searchHeading=$('<h4>').append(searchHeading);var searchPlaceholderText;if($searchContainer.data('search-placeholder')){searchPlaceholderText=$searchContainer.data('search-placeholder');}else{searchPlaceholderText='Search ';searchPlaceholderText+=$searchContainer.data('title')?$searchContainer.data('title'):'calculations';}var searchInputAttributes={id:'calculator-search-input',class:'form-control form-control-sm',type:'text',placeholder:searchPlaceholderText,autocomplete:'off'};var $searchInput=$('<input>',searchInputAttributes).on('input',function(){mw.calculators.searchCalculations($(this).val());}).on('keypress',function(e){if(event.keyCode===13){e.
preventDefault();return!1;}});$searchContainer.append($searchHeading);$searchContainer.append($('<form>').append($searchInput));if($(mw.calculators.selectors.calculationCategories).length){$searchContainer.append($('<form>',{id:'calculator-search-category-form'}));var categoryPlaceholderText;if($searchContainer.data('category-placeholder')){categoryPlaceholderText=$searchContainer.data('category-placeholder');}else{categoryPlaceholderText='(Show all categories)';}var categorySelectAttributes={id:'calculator-category-input',class:'custom-select custom-select-sm'};var $categorySelectInput=$('<select>',categorySelectAttributes).on('change',function(){mw.calculators.selectCategory($(this).val());});$categorySelectInput.append($('<option>',{text:categoryPlaceholderText,value:''}));$(mw.calculators.selectors.calculationCategories).each(function(){$categorySelectInput.append($('<option>',{value:$(this).data('id'),html:$(this).data('title')}));});$('#calculator-search-category-form').
replaceWith($('<form>',{id:'calculator-search-category-form'}).append($categorySelectInput));}};mw.calculators.searchCalculations=function(searchText){var reSearch=new RegExp(searchText,'im');$(mw.calculators.selectors.calculationCategories).each(function(){var $calculations=$(this).find(mw.calculators.selectors.calculations);var showCalculationCategory=!searchText||reSearch.test($(this).data('search'));if(showCalculationCategory){$calculations.each(function(){$(this).show();});}else{$calculations.each(function(){var showCalculation=!searchText||reSearch.test($(this).data('search'));if(showCalculation){$(this).show();showCalculationCategory=!0;}else{$(this).hide();}});}if(showCalculationCategory){$(this).show();}else{$(this).hide();}});$(mw.calculators.selectors.calculations).not(mw.calculators.selectors.calculationCategories+' '+mw.calculators.selectors.calculations).each(function(){if(!searchText||reSearch.test($(this).data('search'))){$(this).show();}else{$(this).hide();}});};mw.
calculators.selectCategory=function(calculationCategoryId){$(mw.calculators.selectors.calculationCategories).each(function(){if(!calculationCategoryId||$(this).data('id')===calculationCategoryId){$(this).show();}else{$(this).hide();}});};mw.calculators.initializeSearch();}());},{"css":["#calculator-search{border-bottom:1px solid #dee2e6;padding:0.25rem 0rem}@media only screen and (min-width:950px){#calculator-search{position:sticky;top:208px;background:#ffffff;z-index:800}}#calculator-search form{flex-wrap:nowrap}#calculator-search h4{padding-top:0}.calculator-search-label{font-size:1.2rem;font-weight:500}#calculator-search-input,#calculator-category-input{width:114%}"]});